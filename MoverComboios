
SELECAO_COMBOIO EQU 8018H
OPERACAO_COMBOIO EQU 801AH
BARRAS_VELOCIDADE EQU 8004H	
MASCARA_VELOCIDADE_ANTES_DE_VERIFICAR EQU 0000000000001011b
MASCARA_VELOCIDADE_DEPOIS_DE_VERIFICAR EQU 0000000010000011b

PLACE 0H
inicio:
	MOV R1,SELECAO_COMBOIO
	MOV R2,OPERACAO_COMBOIO
	MOV R3,BARRAS_VELOCIDADE
	MOVB R4,[R3]
	MOV R5, MASCARA_VELOCIDADE_ANTES_DE_VERIFICAR
	MOV R7, MASCARA_VELOCIDADE_DEPOIS_DE_VERIFICAR

comboio1:
	MOV R6,R4
	ROR R6,4					;roda para a direita para se poder aplicar o mesmo que ao comboio 2
	AND R6, R5					;mascara para ter a certeza que temos apenas os elementos necessários
	BIT R6, 3					;ler o bit 3 para ver a direcção dele
	JZ nextcomboio1				;se o bit for zero a direcção é frente, se for 1 é sentido negativo
	MOV R5, 80H 					
	ADD R6, R5					;poe o sentido negativo
nextcomboio1: 
	AND R6,R7					
	MOV R0,10H					;Selecção do Comboio 1
	MOVB [R1],R0				
	MOVB [R2],R6


comboio2:
	AND R4, R5
	BIT R4, 3					;ler o bit 3 para ver a direcção dele
	JZ nextcomboio2				;se o bit for zero a direcção é frente, se for 1 é sentido negativo
	MOV R5, 80H 					;poe o bit negativo para mudar o sentido
	ADD R4, R5

nextcomboio2: 
	AND R4,R7					; limpeza do que não é necessário
	MOV R0,0H					;Selecção do Comboio 2
	MOVB [R1],R0				
	MOVB [R2],R4

fim:JMP inicio

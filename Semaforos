
TECLADO07 EQU 8006H		     ; 7654 3210
TECLADO8F EQU 8008H		     ; **** **98
SEMAFOROS EQU 8012H		     ; Os bits 7 a 2 indicam o número do semáforo. Os bits 1 e 0 indicam a cor
VERDE EQU 2H                  ; Valor da cor Verde no semaforo
VERMELHO EQU 1H               ; Valor da cor Vermelha no semaforo
CINZENTO EQU 0H              ; Valor da cor Cinzenta no semaforo

PLACE 1000H
cores_semaforos:               ; tabela para as cores dos semáforos (VERDE, CINZENTO ou VERMELHO).
                               ; 00 cinzento, 01 vermelho, 10 verde, 11 amarelo.
     STRING    VERDE           ; cor do semáforo 0
     STRING    VERDE           ; cor do semáforo 1
     STRING    VERDE           ; cor do semáforo 2
     STRING    VERDE           ; cor do semáforo 3
     STRING    VERDE           ; cor do semáforo 4
     STRING    VERDE           ; cor do semáforo 5
     STRING    VERDE           ; cor do semáforo 6
     STRING    VERDE           ; cor do semáforo 7
     STRING    VERDE           ; cor do semáforo 8
     STRING    VERDE           ; cor do semáforo 9


;======================================================================
PLACE 0000H
start:
MOV R1, TECLADO07
MOV R2, TECLADO8F
MOV R3, SEMAFOROS
MOV R4, 0H				 	; iniciarlizar o contador a 0 

verificar_mudanca_dos_botoes:      ; ler o sinal, se foi carregado o semaforo muda de cor; ou seja ler o bit, vamos a cor do semaforo, caso contrario ignora-se.
MOVB R0, [R1]				     ; mover o valor dos botoes para um registo
MOVB R9, [R2]                      ; mover os valores dos botoes 8 a 9 para um registo
CMP R10, R0					; se o valor for igual, aguarda-se mudança
JNZ guardar_valor_lido_dos_botoes
CMP R9,R6
JNZ guardar_valor_lido_dos_botoes
JMP start

guardar_valor_lido_dos_botoes:
MOV R10, R0
MOV R6, R9


verificar_cor_do_semaforo:
BIT R0,0					;testar o bit 0 corresponde a ver se o botao foi carregado 
JZ proximo_botao			;se estiver a 1 o bit mudamos a cor, caso contrário seguimos pro proximo bit


;R4 numero do semaforo a ser mudado, [R5] semaforo tabela, [R3] semaforo registo
;R7 temp que fica com o resultado das contas dando o valor que corresponde ao semaforo
ver_semaforo:
MOV R5, cores_semaforos		; movemos o endereço das cores_semaforos para o R5
ADD R5, R4				; somamos o numero de bit que contamos para saber o semaforo a qual aceder
MOV R7, R4				; guardar o valor de R4 
SHL R7, 2					; shift 2 para se poder somar e gerar um bit na 3a posicao ou superior

ver_cor_da_tabela:
MOVB R8, [R5]
CMP R8, VERDE 				;se for verde, muda para vermelho.
JZ por_semaforo_vermelho

por_semaforo_verde:
MOV R8, VERDE
JMP mudar_semaforo

por_semaforo_vermelho:
MOV R8, VERMELHO

mudar_semaforo:
MOVB [R5], R8
ADD R7, R8				;decide o sinal
MOVB [R3], R7				;escreve no semaforo

proximo_botao:
ADD R4, 1H				;incrementar 1 ao contador
SHR R0, 1					;rodamos para passar ao proximo bit para testar
MOV R7, 8H
CMP R4, R7				;quando 8-R4 for 0, ja vimos todos os bits, por isso repete-se
JNZ verificar_cor_do_semaforo

;===========================================
MOV R4, 8H
verificar_cor_do_semaforo89:
BIT R9, 0
JZ proximo_botao2

ver_semaforo2:
MOV R5, cores_semaforos       ; movemos o endereço das cores_semaforos para o R5
ADD R5, R4                    ; somamos o numero de bit que contamos para saber o semaforo a qual aceder
MOV R7, R4                    ; guardar o valor de R4 
SHL R7, 2                     ; shift 2 para se poder somar e gerar um bit na 3a posicao ou superior

ver_cor_da_tabela2:
MOVB R8, [R5]
CMP R8, CINZENTO               ;se for Cinzento, muda para vermelho.
JZ por_semaforo_vermelho2

por_semaforo_cinzento:
MOV R8, CINZENTO
JMP mudar_semaforo2

por_semaforo_vermelho2:
MOV R8, VERMELHO

mudar_semaforo2:
MOVB [R5], R8
ADD R7, R8                    ;decide o sinal
MOVB [R3], R7                 ;escreve no semaforo

proximo_botao2:
ADD R4, 1H                    ;incrementar 1 ao contador
SHR R9, 1                     ;rodamos para passar ao proximo bit para testar
MOV R7, 0AH
CMP R4, R7                    ;quando 0A-R4 for 0, ja vimos todos os bits, por isso repete-se
JNZ verificar_cor_do_semaforo89

fim: JMP start
